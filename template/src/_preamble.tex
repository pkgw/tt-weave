\documentclass{tdux}

% plain/webmac compatibility

\countdef\pageno=0
\def\contentspagenumber{0}
\def\item{\par}
\def\yskip{}

% left-arrow allusion in WEAVE.WEB
\catcode`\^^X=\active
\def^^X{‚Üê}

% up-arrow allusion in WEAVE.WEB
\catcode`\^^K=\active
\def^^K{(up-arrow)}

% WEAVE.WEB: `\.^^Z\ `
\catcode`\^^Z=\active
\def^^Z{\^\^Z}

\makeatletter
\def\eqalign#1{\null\,\vcenter{\openup\jot\m@th
  \ialign{\strut\hfil$\displaystyle{##}$&$\displaystyle{{}##}$\hfil
      \crcr#1\crcr}}\,}
\makeatother

\let\justTeX=\TeX
\def\TeX{\special{tdux:cs math}\justTeX\special{tdux:ce math}}

% tt-weave commands

\newcommand{\WebMajorModule}[1]{\newpage\par\textbf{#1.}}
\newcommand{\WebMinorModule}[1]{\newpage\par\textbf{#1.}}

\newenvironment{WebPrettified}{%
  \ifmmode\else\ttfamily\fi
  \special{tdux:mfs pre}\special{tdux:mfs code}%
}{
  \special{tdux:me code}\special{tdux:me pre}%
  \ifmmode\else\rmfamily\fi
}

\newcommand{\TodoOctalLiteral}{OCTAL:}
\newcommand{\TodoHexLiteral}{HEX:}

% {foreground-color}{background-color}{font-options}{text}
% todo ignoring font options
\newcommand{\WebPrettifiedCodeSpan}[4]{%
  \special{tdux:mfs span^^J%
Scolor #1^^J%
Sbackground-color #2^^J%
}#4\special{tdux:me span}%
}
\let\S=\WebPrettifiedCodeSpan

% Ready to go!

\begin{document}

% Plain TeX definitions that could cause problems for LaTeX if we did them
% earlier:
\def\.#1{\texttt{#1}}
\def\'{\textquotesingle}
\def\~{\texttildelow}
\def\\{\textbackslash}
